<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Michael Mayer" />

<meta name="date" content="2021-03-20" />

<title>Censored Variables</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Censored Variables</h1>
<h4 class="author">Michael Mayer</h4>
<h4 class="date">2021-03-20</h4>



<div id="how-to-deal-with-censored-variables" class="section level2">
<h2>How to deal with censored variables?</h2>
<p>There is no obvious way of how to deal with survival variables as covariables in imputation models.</p>
<p>Options discussed in <span class="citation">(White and Royston <a href="#ref-white" role="doc-biblioref">2009</a>)</span> include:</p>
<ul>
<li><p>Use both status variable s and (censored) time variable t</p></li>
<li><p>s and log(t)</p></li>
<li><p>surv(t), and, optionally s</p></li>
</ul>
<p>By surv(t), we denote the Nelson-Aalen survival estimate at each value of t. The third option is the most elegant one as it explicitly deals with censoring information. We provide some additional details on it in the example</p>
<div id="example" class="section level3">
<h3>Example</h3>
<p>For illustration, we use data from a randomized two-arm trial about lung cancer. The aim is to estimate the treatment effect of “trt” with reliable inference using Cox regression. Unfortunately, we have added missing values in the covariables “age”, “karno”, and “diagtime”.</p>
<p>A reasonable way to estimate the covariable adjusted treatment effect is the following:</p>
<ol style="list-style-type: decimal">
<li>Add Nelson-Aalen survival estimates “surv” to the dataset.</li>
<li>Use “surv” as well as the covariables to impute missing values in the covariables multiple times.</li>
<li>Perform the intended Cox regression for each of the imputed data sets.</li>
<li>Pool their results by Rubin’s rule <span class="citation">(Rubin <a href="#ref-rubin" role="doc-biblioref">1987</a>)</span>, using package <code>mice</code> <span class="citation">(Buuren and Groothuis-Oudshoorn <a href="#ref-buuren" role="doc-biblioref">2011</a>)</span>.</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(missRanger)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(survival)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(mice)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">set.seed</span>(<span class="dv">65</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">head</span>(veteran)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt;   trt celltype time status karno diagtime age prior</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; 1   1 squamous   72      1    60        7  69     0</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; 2   1 squamous  411      1    70        5  64    10</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; 3   1 squamous  228      1    60        3  38     0</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; 4   1 squamous  126      1    60        9  63    10</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt; 5   1 squamous  118      1    70       11  65    10</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt; 6   1 squamous   10      1    20        5  49     0</span></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co"># 1. Calculate Nelson-Aalen survival probabilities for each time point</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>nelson_aalen &lt;-<span class="st"> </span><span class="kw">summary</span>(</span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="kw">survfit</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> veteran), </span>
<span id="cb1-18"><a href="#cb1-18"></a>  <span class="dt">times =</span> <span class="kw">unique</span>(veteran<span class="op">$</span>time)</span>
<span id="cb1-19"><a href="#cb1-19"></a>)[<span class="kw">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;surv&quot;</span>)]</span>
<span id="cb1-20"><a href="#cb1-20"></a>nelson_aalen &lt;-<span class="st"> </span><span class="kw">data.frame</span>(nelson_aalen)</span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co"># Add it to the original data set</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>veteran2 &lt;-<span class="st"> </span><span class="kw">merge</span>(veteran, nelson_aalen, <span class="dt">all.x =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-24"><a href="#cb1-24"></a></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="co"># Add missing values to make things tricky</span></span>
<span id="cb1-26"><a href="#cb1-26"></a>veteran2 &lt;-<span class="st"> </span><span class="kw">generateNA</span>(veteran2, <span class="dt">p =</span> <span class="kw">c</span>(<span class="dt">age =</span> <span class="fl">0.1</span>, <span class="dt">karno =</span> <span class="fl">0.1</span>, <span class="dt">diagtime =</span> <span class="fl">0.1</span>))</span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co"># 2. Generate 20 complete data sets, representing &quot;time&quot; and &quot;status&quot; by &quot;surv&quot;</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>filled &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">20</span>, <span class="kw">missRanger</span>(veteran2, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>time <span class="op">-</span><span class="st"> </span>status, </span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="dt">verbose =</span> <span class="dv">0</span>, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">25</span>), <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-31"><a href="#cb1-31"></a></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co"># 3. Run a Cox regression for each of the completed data sets</span></span>
<span id="cb1-33"><a href="#cb1-33"></a>models &lt;-<span class="st"> </span><span class="kw">lapply</span>(filled, <span class="cf">function</span>(x) <span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>surv, x))</span>
<span id="cb1-34"><a href="#cb1-34"></a></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="co"># 4. Pool the results by mice</span></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="kw">summary</span>(pooled_fit &lt;-<span class="st"> </span><span class="kw">pool</span>(models))</span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="co">#&gt;                term     estimate   std.error  statistic        df      p.value</span></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="co">#&gt; 1               trt  0.238408881 0.213416156  1.1171079 108.30303 2.664203e-01</span></span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="co">#&gt; 2 celltypesmallcell  0.801088770 0.286383107  2.7972626 112.17712 6.066665e-03</span></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="co">#&gt; 3     celltypeadeno  1.134351839 0.308977998  3.6713030 110.65791 3.731780e-04</span></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="co">#&gt; 4     celltypelarge  0.327092592 0.291069423  1.1237614 109.29555 2.635765e-01</span></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="co">#&gt; 5             karno -0.031250557 0.005786704 -5.4004073  99.60711 4.529695e-07</span></span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="co">#&gt; 6          diagtime  0.002889092 0.009020319  0.3202872 106.17585 7.493801e-01</span></span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="co">#&gt; 7               age -0.007620985 0.009632902 -0.7911411  97.27459 4.307864e-01</span></span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="co">#&gt; 8             prior  0.003954604 0.023537476  0.1680131 111.98360 8.668760e-01</span></span>
<span id="cb1-46"><a href="#cb1-46"></a></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="co"># On the original</span></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="kw">summary</span>(<span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>., veteran))<span class="op">$</span>coefficients</span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="co">#&gt;                            coef exp(coef)    se(coef)            z     Pr(&gt;|z|)</span></span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="co">#&gt; trt                2.946028e-01 1.3425930 0.207549604  1.419433313 1.557727e-01</span></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="co">#&gt; celltypesmallcell  8.615605e-01 2.3668512 0.275284474  3.129709606 1.749792e-03</span></span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="co">#&gt; celltypeadeno      1.196066e+00 3.3070825 0.300916994  3.974738536 7.045662e-05</span></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="co">#&gt; celltypelarge      4.012917e-01 1.4937529 0.282688638  1.419553530 1.557377e-01</span></span>
<span id="cb1-54"><a href="#cb1-54"></a><span class="co">#&gt; karno             -3.281533e-02 0.9677173 0.005507757 -5.958020093 2.553121e-09</span></span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="co">#&gt; diagtime           8.132051e-05 1.0000813 0.009136062  0.008901046 9.928981e-01</span></span>
<span id="cb1-56"><a href="#cb1-56"></a><span class="co">#&gt; age               -8.706475e-03 0.9913313 0.009300299 -0.936149992 3.491960e-01</span></span>
<span id="cb1-57"><a href="#cb1-57"></a><span class="co">#&gt; prior              7.159360e-03 1.0071850 0.023230538  0.308187441 7.579397e-01</span></span></code></pre></div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-buuren">
<p>Buuren, Stef van, and Karin Groothuis-Oudshoorn. 2011. “Mice: Multivariate Imputation by Chained Equations in R.” <em>Journal of Statistical Software, Articles</em> 45 (3): 1–67. <a href="https://doi.org/10.18637/jss.v045.i03">https://doi.org/10.18637/jss.v045.i03</a>.</p>
</div>
<div id="ref-rubin">
<p>Rubin, D. B. 1987. <em>Multiple Imputation for Nonresponse in Surveys</em>. Wiley Series in Probability and Statistics. Wiley.</p>
</div>
<div id="ref-white">
<p>White, Ian R., and Patrick Royston. 2009. “Imputing Missing Covariate Values for the Cox Model.” <em>Statistics in Medicine</em> 28 (15): 1982–98. <a href="https://doi.org/10.1002/sim.3618">https://doi.org/10.1002/sim.3618</a>.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
